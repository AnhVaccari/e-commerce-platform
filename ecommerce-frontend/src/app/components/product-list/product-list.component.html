<div class="product-list-container">
  <h2>Notre Catalogue</h2>

  <!-- Barre de recherche et filtres -->
  <div class="search-container">
    <input
      type="text"
      class="search-input"
      placeholder="Rechercher un produit..."
      [(ngModel)]="searchTerm"
      (keyup.enter)="onSearch()"
      (input)="onSearch()"
    />

    <select class="category-filter" [(ngModel)]="selectedCategoryId" (change)="onCategoryFilter()">
      <option [value]="null">Toutes les cat√©gories</option>
      @for (category of categories; track category.id) {
      <option [value]="category.id">{{ category.name }}</option>
      }
    </select>

    <button class="search-btn" (click)="onSearch()">üîç</button>

    @if (searchTerm || selectedCategoryId) {
    <button
      class="clear-search-btn"
      (click)="searchTerm = ''; selectedCategoryId = null; loadProducts()"
    >
      ‚úï Effacer filtres
    </button>
    }
  </div>

  <!-- Loading -->
  @if (isLoading) {
  <div class="loading">
    <p>Chargement des produits...</p>
  </div>
  }

  <!-- Error -->
  @if (errorMessage) {
  <div class="error">
    <p>{{ errorMessage }}</p>
    <button (click)="loadProducts()" class="retry-btn">R√©essayer</button>
  </div>
  }

  <!-- Products Grid -->
  @if (!isLoading && !errorMessage && products.length > 0) {
  <div class="products-grid">
    @for (product of products; track product.id) {
    <div class="product-card">
      <div class="product-header">
        <h3>{{ product.name }}</h3>
        <span class="category-badge">{{ product.category.name }}</span>
      </div>

      <p class="product-description">{{ product.description }}</p>

      <div class="product-footer">
        <div class="price-stock">
          <span class="price">{{ product.price }}‚Ç¨</span>

          <span
            class="availability"
            [class.in-stock]="product.stock > 10"
            [class.limited-stock]="product.stock > 0 && product.stock <= 10"
            [class.out-of-stock]="product.stock === 0"
          >
            @if (product.stock > 10) { En stock } @else if (product.stock > 0) { Stock limit√© }
            @else { Rupture de stock }
          </span>
        </div>

        <button
          class="add-to-cart-btn"
          [disabled]="product.stock === 0"
          (click)="addToCart(product)"
        >
          @if (product.stock > 0) { Ajouter au panier } @else { Rupture de stock }
        </button>
      </div>
    </div>
    }
  </div>
  }

  <!-- Empty state -->
  @if (!isLoading && !errorMessage && products.length === 0) {
  <div class="empty-state">
    <p>Aucun produit disponible pour le moment.</p>
  </div>
  }
</div>
